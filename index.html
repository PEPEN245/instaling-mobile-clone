<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
 <title>Nauka angielskiego</title>
  <!-- favicon i ikony PWA -->
<link rel="icon" type="image/png" sizes="192x192" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">

<!-- manifest PWA -->
<meta name="theme-color" content="#58a6ff">

  <title>Nauka słówek</title>
  <style>
    :root {
      --bg: #f6fbff;
      --primary: #58a6ff;
      --card: #ffffff;
      --radius: 16px;
      --text: #002348;
      --shadow: rgba(0,0,0,0.08);
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }

    * { box-sizing: border-box; }

    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    body {
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .app {
      width: 100%;
      max-width: 480px;
      min-height: 100dvh;
      padding: 20px 16px 100px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    h1 {
      text-align: center;
      font-size: 1.6rem;
      margin: 0;
      color: var(--text);
    }

    p {
      text-align: center;
      margin: 0;
      font-size: 0.9rem;
      color: #666;
    }

    .add-word {
      background: var(--card);
      box-shadow: 0 2px 6px var(--shadow);
      border-radius: var(--radius);
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .inputs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    input {
      flex: 1;
      padding: 10px 12px;
      border: 1px solid #d0d0d0;
      border-radius: var(--radius);
      font-size: 1rem;
    }

    button {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius);
      padding: 10px 14px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: 0.2s;
    }

    button:hover { opacity: 0.9; }

    .word-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .word {
      background: var(--card);
      box-shadow: 0 1px 3px var(--shadow);
      border-radius: var(--radius);
      padding: 10px 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .word small {
      color: #777;
      font-size: 0.8rem;
    }

    .start-btn {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: calc(100% - 40px);
      max-width: 480px;
      background: var(--primary);
      color: white;
      font-size: 1.2rem;
      padding: 14px;
      border-radius: var(--radius);
      text-align: center;
      cursor: pointer;
    }

    .overlay {
      position: fixed;
      inset: 0;
      height: 100dvh;
      width: 100%;
      background: var(--card);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
      z-index: 100;
    }

    .game-card {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 360px;
    }

    .game-card input { font-size: 1.1rem; }

    .hidden { display: none; }

    .word-display {
      font-size: 1rem;
      color: #333;
      background: #f0f6ff;
      border-radius: 8px;
      padding: 6px 10px;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Nauka słówek</h1>
    <p>developed by Filip Misiewicz</p>

    <div class="add-word">
      <div class="inputs">
        <input id="pl" placeholder="Polski (np. kot)" />
        <input id="en" placeholder="English (e.g. cat)" />
        <button id="add">Dodaj</button>
      </div>
      <button id="clear" style="background:#ccc;color:#222;">Wyczyść</button>
    </div>

    <div class="word-list" id="list"></div>
  </div>

  <div class="start-btn" id="start">Rozpocznij</div>

  <div class="overlay" id="overlay">
    <div class="game-card" id="game">
      <h2 id="question"></h2>
      <input id="answer" placeholder="Wpisz tłumaczenie..." />
      <button id="next">Dalej</button>
    </div>

    <div class="game-card hidden" id="positive">
      <h2>✅ Poprawnie!</h2>
      <p class="word-display" id="posWord"></p>
      <button id="nextPos">Dalej</button>
    </div>

    <div class="game-card hidden" id="negative">
      <h2>❌ Niepoprawnie!</h2>
      <p class="word-display" id="negWord"></p>
      <button id="nextNeg">Dalej</button>
    </div>

    <div class="game-card hidden" id="close">
      <h2>⚠️ Blisko!</h2>
      <button id="retryClose">Napisz ponownie</button>
    </div>

    <div class="game-card hidden" id="end">
      <h2>Koniec!</h2>
      <p id="summary"></p>
      <button id="back">Wróć</button>
    </div>
  </div>

  <script>
    const pl = document.getElementById("pl");
    const en = document.getElementById("en");
    const addBtn = document.getElementById("add");
    const clearBtn = document.getElementById("clear");
    const list = document.getElementById("list");
    const startBtn = document.getElementById("start");
    const overlay = document.getElementById("overlay");
    const question = document.getElementById("question");
    const answer = document.getElementById("answer");
    const nextBtn = document.getElementById("next");
    const posDiv = document.getElementById("positive");
    const negDiv = document.getElementById("negative");
    const closeDiv = document.getElementById("close");
    const endDiv = document.getElementById("end");
    const gameDiv = document.getElementById("game");
    const posWord = document.getElementById("posWord");
    const negWord = document.getElementById("negWord");
    const nextPos = document.getElementById("nextPos");
    const nextNeg = document.getElementById("nextNeg");
    const retryClose = document.getElementById("retryClose");
    const summary = document.getElementById("summary");
    const back = document.getElementById("back");

    let words = JSON.parse(localStorage.getItem("words") || "[]");
    let gameWords = [];
    let index = 0;
    let closeCount = 0;
    let correctCount = 0;

    function renderList() {
      list.innerHTML = "";
      words.forEach((w, i) => {
        const div = document.createElement("div");
        div.className = "word";
        div.innerHTML = `<div><b>${w.pl}</b><br><small>${w.en}</small></div>
                         <button onclick="removeWord(${i})">Usuń</button>`;
        list.appendChild(div);
      });
    }

    function removeWord(i) {
      words.splice(i, 1);
      localStorage.setItem("words", JSON.stringify(words));
      renderList();
    }

    addBtn.onclick = () => {
      if (!pl.value.trim() || !en.value.trim()) return;
      words.push({ pl: pl.value.trim(), en: en.value.trim() });
      localStorage.setItem("words", JSON.stringify(words));
      pl.value = ""; en.value = "";
      renderList();
    };

    clearBtn.onclick = () => {
      words = [];
      localStorage.setItem("words", "[]");
      renderList();
    };

    startBtn.onclick = () => {
      if (words.length === 0) return alert("Najpierw dodaj słówka!");
      gameWords = [...words];
      index = 0;
      closeCount = 0;
      correctCount = 0;
      overlay.style.display = "flex";
      showWord();
    };

    function showWord() {
      if (index >= gameWords.length) return endGame();
      gameDiv.classList.remove("hidden");
      posDiv.classList.add("hidden");
      negDiv.classList.add("hidden");
      closeDiv.classList.add("hidden");
      endDiv.classList.add("hidden");
      question.textContent = gameWords[index].pl;
      answer.value = "";
      answer.focus();
    }

    nextBtn.onclick = () => checkAnswer();

    function checkAnswer() {
      const correct = gameWords[index].en.trim().toLowerCase();
      const user = answer.value.trim().toLowerCase();
      if (!user) return;
      if (user === correct) {
        correctCount++;
        posWord.textContent = `${gameWords[index].pl} - ${gameWords[index].en}`;
        gameDiv.classList.add("hidden");
        posDiv.classList.remove("hidden");
        gameWords.splice(index, 1);
      } else if (levenshtein(user, correct) <= 2 && closeCount < 3) {
        closeCount++;
        gameDiv.classList.add("hidden");
        closeDiv.classList.remove("hidden");
      } else {
        negWord.textContent = `${gameWords[index].pl} - ${gameWords[index].en}`;
        gameDiv.classList.add("hidden");
        negDiv.classList.remove("hidden");
        gameWords.push(gameWords[index]);
        index++;
      }
    }

    nextPos.onclick = () => showWord();
    nextNeg.onclick = () => showWord();
    retryClose.onclick = () => showWord();
    back.onclick = () => overlay.style.display = "none";

    function endGame() {
      gameDiv.classList.add("hidden");
      posDiv.classList.add("hidden");
      negDiv.classList.add("hidden");
      closeDiv.classList.add("hidden");
      endDiv.classList.remove("hidden");
      summary.textContent = `Poprawnych odpowiedzi: ${correctCount}`;
    }

    function levenshtein(a, b) {
      const matrix = [];
      for (let i = 0; i <= b.length; i++) matrix[i] = [i];
      for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
      for (let i = 1; i <= b.length; i++) {
        for (let j = 1; j <= a.length; j++) {
          matrix[i][j] = b[i-1] === a[j-1]
            ? matrix[i-1][j-1]
            : Math.min(matrix[i-1][j-1] + 1, matrix[i][j-1] + 1, matrix[i-1][j] + 1);
        }
      }
      return matrix[b.length][a.length];
    }

    renderList();
  </script>
</body>
</html>
